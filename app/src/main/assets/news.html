<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=0"/>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"/>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/jquery.dst.js"></script>
    <script>

        var hdrCategoriesVar = $('#hdrCategories');
        var contentCategoriesVar = $('#contentCategories');
        var ftrCategoriesVar = $('#ftrCategories');

        var hdrSelectVar = $('#hdrSelect');
        var contentSelectVar = $('#contentSelect');
        var ftrSelectVar = $('#ftrSelect');

        var hdrProgressVar = $('#hdrProgress');
        var contentProgressVar = $('#contentProgress');
        var ftrProgressVar = $('#ftrProgress');

        var hdrNewsVar = $('#hdrNews');
        var contentNewsVar = $('#contentNews');
        var ftrNewsVar = $('#ftrNews');


        function hideCategories(){
           hdrCategoriesVar.hide();
           contentCategoriesVar.hide();
           ftrCategoriesVar.hide();
        }
        function hideSelect(){
           hdrSelectVar.hide();
           contentSelectVar.hide();
           ftrSelectVar.hide();
        }

        function hideNews(){
           hdrNewsVar.hide();
           contentNewsVar.hide();
           ftrNewsVar.hide();
        }

        function hideProgress(){
           hdrProgressVar.hide();
           contentProgressVar.hide();
           ftrProgressVar.hide();
        }

        function showCategories(){
           hideSelect();
           hideProgress();
           hideNews();
           hdrCategoriesVar.show();
           contentCategoriesVar.show();
           ftrCategoriesVar.show();
        }

        function showSelect(){
           hideCategories();
           hideProgress();
           hideNews();
           hdrSelectVar.show();
           contentSelectVar.show();
           ftrSelectVar.show();
        }

        function showNews(){
           hideCategories();
           hideSelect();
           hideProgress();
           hdrNewsVar.show();
           contentNewsVar.show();
           ftrNewsVar.show();
        }

        function showProgress(){
           hideCategories();
           hideSelect();
           hideNews();
           hdrProgressVar.show();
           contentProgressVar.show();
           ftrProgressVar.show();
        }


        var COMMA = ',';
        var COOKIE_NAME = 'news';
        var numNewsToRestore= 0;
        var storedNewsArr;
        $(document).ready(function () {

          showProgress();
          var storedNewsTxt = $.DSt.get(COOKIE_NAME);

          if(storedNewsTxt != null && storedNewsTxt.length > 0){
             storedNewsArr = storedNewsTxt.split(COMMA);
          }else{
             storedNewsArr = new Array();
          }
          numNewsToRestore = storedNewsArr.length;
          restore();
        });

        function restore(){
          if(numNewsToRestore > 0){
             getNews(storedNewsArr[--numNewsToRestore],restoreNews);
          }else{
             showCategories();
          }
        }

        var NEWS_URI = 'http://rss.news.yahoo.com/rss/';

        function getNews(varCat,handler){
           var varURI = NEWS_URI + varCat;
           $.ajax({type: GET, dataType: XML, url: varURI, success: handler});
           return false;
        }

        function restoreNews(xml){
           populateSingleNews(xml);
           restore();
        }

        var CATEGORY = 'category';
        var DESCR = 'description';
        var currentNewsVar = $('#currentNews');

        function populateSingleNews(xml){

          var tmpTxt = $(xml).find(CATEGORY).first().text();
          var desc = $(xml).find(DESCR).first().text();

          var category = CAT_ + tmpTxt;
          var categoryDel = category + _D;
          var categoryLi = categoryDel + _LI;
          var categoryA = category + _A;

          category='cat_business'
          categoryDel='cat_business_d'
          categoryLi='cat_business_d_li'
          categoryA='cat_business_a'

          var HTML_FRG1 = '<li id="';
          var HTML_FRG2 = '"><h3><a id="';
          var HTML_FRG3 = '"  href="#">';
          var HTML_FRG4 = '</a></h3><p id="';
          var HTML_FRG5 = '"></p><a href="#" data-transition="slideup" id="';
          var HTML_FRG6 = '"/></li>';

            $(HTML_FRG1 + categoryLi + HTML_FRG2 + categoryA + HTML_FRG3 + desc + HTML_FRG4 + category + HTML_FRG5 +
                categoryDel + HTML_FRG6).prependTo(currentNewsVar);

          var newDeleteItem = document.getElementById(categoryDel);
          $(newDeleteItem).click(function() {
                $.doTimeout( categoryLi, false );
                var newListItem = document.getElementById(categoryLi);
                $(newListItem).remove();
                storeCurrentNews();
            });

          var newDescItem = document.getElementById(categoryA);
          $(newDescItem).click(function() {
            showProgress();
            getNews(category.substring(4),populateNewsItems);
          });

        }

        var TWO_SECONDS = 2000;
        function animate(pArr,animationTarget,handle){
            var len = pArr.length;
            var currInd = 1;
            animationTarget.doTimeout(handle,TWO_SECONDS, function(){
            this.fadeOut(function(){
                 currInd = currInd % len;
                 animationTarget.text(pArr[currInd++]);
                 animationTarget.fadeIn();
            });
            return true;
        });

        var EMPTY = '';

        function changeLocation(varURI){
          showProgress();
          $.get(EMPTY,function(data){
            window.location = varURI;
          });
        }
        }

    </script>

    <title>My News Application</title>
</head>

<!-- Categories -->
<div data-role="page" data-theme="b" id="Categories">
    <div data-role="header" id="hdrCategories" data-nobackbtn="true">
        <h1>Categories</h1>
        <a id="buttonAddCategory" data-icon="plus" class="ui-btn-left" href="#CategorySelection"
           data-role="button" data-inline="true">Add</a>
    </div>

    <div data-role="content" id="contentCategories">
        <ul data-role="listview" data-split-icon="delete" data-split-theme="d"
            id="currentNews"></ul>
    </div>

    <div data-role="footer" id="ftrCategories"></div>

</div>
<div data-role="page" data-theme="b" id="CategorySelection">
    <!-- Category Selection -->
    <div data-role="header" id="hdrSelect" data-nobackbtn="true">
        <h1>Select</h1>
    </div>

    <div data-role="content" id="contentSelect">
        <form id="form1">
            <div id="categoryDiv" data-role="fieldcontain">
                <select id="category" tabindex="2">
                    <option value=''>Select a Category</option>
                    <option value='topstories'>Top Stories</option>
                    <option value='us'>U.S.</option>
                    <option value='world'>World</option>
                    <option value='politics'>Politics</option>
                </select>
            </div>
            <a id="buttonGetCategory" href="#Categories" data-role="button" data-inline="true">Get Category</a>
        </form>
    </div>

    <div data-role="footer" id="ftrSelect"></div>
</div>

<div data-role="page" data-theme="b" id="News">
    <!-- News -->
    <div data-role="header" id="hdrNews" data-nobackbtn="true">
        <h1>News</h1>
        <a id="buttonHdrShowCategories" data-icon="arrow-l" class="ui-btn-left" href=""
           data-role="button" data-inline="true">Back</a>
    </div>

    <div data-role="content" id="contentNews"></div>

    <div data-role="footer" id="ftrNews">
        <a id="buttonFtrShowCategories" data-icon="arrow-l" class="ui-btn-left" href=""
           data-role="button" data-inline="true">Back to News Categories</a>
    </div>
</div>

<div data-role="page" data-theme="b" id="Progress">
    <!--  Progress -->
    <div data-role="header" id="hdrProgress" data-nobackbtn="true">
        <h1>Processing...</h1>
    </div>

    <div data-role="content" id="contentProgress">
        <div align="CENTER"><h4>Please wait.</h4></div>
        <div align="CENTER"><img id="spin" src="img/wait.gif"/></div>
    </div>

    <div data-role="footer" id="ftrProgress"></div>
</div>
</body>
</html>